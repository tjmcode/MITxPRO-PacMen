<!-- #region  H E A D E R -->
<!-- copyright file="index.html" company="MicroCODE Incorporated" Copyright Â© 2022 MicroCODE Incorporated Troy, MI author="Timothy J. McGuire" -->
<!-- #region  P R E A M B L E -->
<!-- #region  D O C U M E N T A T I O N -->
<!--
 *      Title:    MIT xPRO - WEEK 7 - PacMen Exersize
 *      Module:   Modules (MicroCODE:index.html)
 *      Customer: Internal
 *      Creator:  MicroCODE Incorporated
 *      Date:     March 2022
 *      Author:   Timothy J McGuire
 *
 *      Designed and Coded: 2022 MicroCODE Incorporated
 *
 *      This software and related materials are the property of
 *      MicroCODE Incorporated and contain confidential and proprietary
 *      information. This software and related materials shall not be
 *      duplicated, disclosed to others, or used in any way without the
 *      written of MicroCODE Incorported.
 *
 *
 *      DESCRIPTION:
 *      ------------
 *
 *      This module implements the MicroCODE's Common HTML Template.
 *      This file is copied to start all MicroCODE Web Pages.
 *
 *
 *      REFERENCES:
 *      -----------
 *
 *      1. MicroCODE JavaScript Style Guide
 *         Local File: MCX-S02 (Internal JS Style Guide).docx
 *         https://github.com/MicroCODEIncorporated/JavaScriptSG
 *
 *      2. ...
 *
 *
 *      DEMONSTRATION VIDEOS:
 *      --------------------
 *
 *      1. ...
 *
 *
 *
 *      MODIFICATIONS:
 *      --------------
 *
 *  Date:         By-Group:   Rev:     Description:
 *
 *  05-Mar-2022   TJM-MCODE  {0001}    New file created from the MicroCODE HTML Template for "PacMen" exercise.
 *
 *
-->

<!-- #endregion -->
<!-- #endregion -->
<!-- #endregion -->

<!-- H T M L : page layout -->
<html lang="en">

    <!-- #region  C S S : visual styles -->
    <style>

    </style>
    <!-- #endregion -->

    <!-- #region  H E A D E R -->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible"
              content="IE=edge">
        <meta name="viewport"
              content="width=120, initial-scale=1.0">
        <title>MIT xPRO: WEEK n</title>
    </head>
    <!-- #endregion -->

    <!-- #region  B O D Y -->
    <body>
        <div id='game'>
            <button id="btnUI_Button1"
                    width='200'
                    height='30'>Add PacMan</button>
            <button id="btnUI_Button2"
                    width='200'
                    height='30'>Start Game</button>
            <button id="btnUI_Button3"
                    width='200'
                    height='30'>Pause Game</button>
            <button id="btnUI_Button4"
                    width='200'
                    height='30'>Stop Game</button>
        </div>
    </body>
    <!-- #endregion -->

    <!-- #region  D A T A B A S E : data source(s) -->
    <!-- <script src="dataSourceName.js"></script> -->
    <!-- #endregion -->

    <!-- #region  I M P O R T : shared JavaScript code -->
    <!-- Include our common MicroCODE Client Library -->
    <!-- <script src="mcodeClient.js"></script> -->
    <!-- #endregion -->

    <!-- J A V A S C R I P T : page specific code -->
    <script>
        // #region  P R I V A T E   F I E L D S

        const gameTimer = {};  // timer controlling the game
        const pacMen = []; // This array holds all the PacMen
        const pacArray = [
            ['./images/PacMan1.png', './images/PacMan2.png'],
            ['./images/PacMan3.png', './images/PacMan4.png'],
        ];

        var pos = 0;
        var direction = 0;

        // #endregion

        // #region  P R I V A T E   F U N C T I O N S
        /**
         * @function setToRandom() -- generate a random position or X/Y velocities.
         *
         * @param {number} scale control on the size of the generated numbers.
         * @returns {object} holding the X, Y position or velocities.
         */
        function setToRandom(scale)
        {
            return {
                x: Math.random() * scale,
                y: Math.random() * scale
            };
        }

        /**
         * @function makePac() -- Factory to make a PacMan at a random position with random velocity.
         *
         * @returns {object} describing a new 'PacMan' at a random position.
         */
        function makePac()
        {
            // returns an object with random values scaled {x: *, y: *}
            let velocity = setToRandom(10);
            let position = setToRandom(200);

            // Add image to div id = game
            let game = document.getElementById('game');
            let newimg = document.createElement('img');

            newimg.style.position = 'absolute';
            newimg.src = './images/PacMan1.png';
            newimg.width = 100;

            // Set position here
            newimg.style.left = position.x;
            newimg.style.top = position.y;

            // Add new Child image to game
            game.appendChild(newimg);

            // return details in an object
            return;
            {
                position, velocity, newimg;
            };
        }

        /**
         * @function addNewPacMan() -- make a PacMan and adds it to the private Context Array.
         *
         * @returns {?} ...
         */
        function addNewPacMan()
        {
            pacMen.push(makePac()); // add a new PacMan
        }

        /**
         * @function checkCollisions() -- checks a PacMan position and changes direction when it hits a wall.
         *
         * @returns {?} ...
         */
        function checkCollisions(item)
        {
            // Detect collision with all walls and make pacman bounce

            // Check X-Axis
            if (item.position.x + item.velocity.x + item.newimg.width > window.innerWidth
                || item.position.x + item.velocity.x < 0)
            {
                item.velocity.x = -item.velocity.x;
            }

            // Check Y-Axis
            if (item.position.y + item.velocity.y + item.newimg.height > window.innerHeight
                || item.position.y + item.velocity.y < 0)
            {
                item.velocity.y = -item.velocity.y;
            }
        }

        /**
         * @function UpdatePacMen() -- Factory to make a PacMan at a random position with random velocity.
         *
         * @returns {object} describing a new 'PacMan' at a random position.
         */
        function UpdatePacMen()
        {
            // loop over pacMen array and move each one and update the DOM
            pacMen.forEach((item) =>
            {
                checkCollisions(item);

                item.position.x += item.velocity.x;
                item.position.y += item.velocity.y;

                item.newimg.style.left = item.position.x;
                item.newimg.style.top = item.position.y;
            });
        }

        // #endregion

        // #region  C A L L B A C K S
        /*
         * callback*() - callback* description.
         */
        function callbackFormatter(messageData)
        {
            // handle item manipulation...
            return messageData + _notImplemented;
        }

        // #endregion

        // #region  E V E N T   H A N D L E R S
        /*
         * btnUI_*_Click() - event handlers for UI buttons.
         */

        // Button #1 handler: ADD PACMAN
        function btnUI_Button1_Click(messageData1, callBack)
        {
            // Log 'Click'...
            console.log(callBack(messageData1));

            // Add a 'PacMan' to the Game...
            addNewPacMan();
        }

        // Button #2 handler: START GAME
        function btnUI_Button2_Click(messageData2, callBack)
        {
            // Handle 'Click'...
            console.log(callBack(messageData2));

            // Start the Game...
            gameTimer = setTimeout(UpdatePacMen, 20);
        }

        // Button #3 handler: PAUSE GAME
        function btnUI_Button3_Click(messageData3, callBack)
        {
            // Handle 'Click'...
            console.log(callBack(messageData3));

            // Pause the Game...
            clearTimeout(gameTimer);
        }

        // Button #4 handler: STOP GAME
        function btnUI_Button4_Click(messageData4, callBack)
        {
            // Handle 'Click'...
            console.log(callBack(messageData4));

            // Stop the Game...
            clearTimeout(gameTimer);

            // clear all the PacMen from the DOM
            pacMen.forEach((item) =>
            {
                game.removeChild(item);
            });

            // clear the PacMen from our Context
            pacMen = [];
        }

        // #endregion

        // #region  E X E C U T I O N

        // Load data sources...

        // Map Event Handlers...
        document.getElementById("btnUI_Button1")
            .addEventListener("click", () => { btnUI_Button1_Click('Button #1: Add PacMan', callbackFormatter); });

        document.getElementById("btnUI_Button2")
            .addEventListener("click", () => { btnUI_Button2_Click('Button #2: Start Game', callbackFormatter); });

        document.getElementById("btnUI_Button3")
            .addEventListener("click", () => { btnUI_Button3_Click('Button #3: Pause Game', callbackFormatter); });

        document.getElementById("btnUI_Button4")
            .addEventListener("click", () => { btnUI_Button4_Click('Button #4: Stop Game', callbackFormatter); });

        // Set Timeout Events...

        // Run Timed Events...

        // #endregion
    </script>

</html>